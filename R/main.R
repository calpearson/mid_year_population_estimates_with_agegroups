## ---------------------------
##
## Script name: gen pop estimates
##
## Purpose of script: purpose
##
## Author: Callum Pearson // callum.pearson@ukhsa.gov.uk
##
## Date Created: 25-09-2025
##
## ---------------------------
##
## Overview: Data is taken from the following https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/estimatesofthepopulationforenglandandwales
##   https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/bulletins/populationestimatesforenglandandwales/previousreleases?page=1
##
## ---------------------------

## 0) Get started ----

# Source Cal_Functions.R from GitHub
source("https://raw.githubusercontent.com/calpearson/Cal_Functions/main/Cal_Functions.R")

# Source Cal_Packages.R from GitHub
source("https://raw.githubusercontent.com/calpearson/Cal_Functions/main/Cal_packages.R")

# mid_year_pops
mid_year_pop <- data.frame(
  Code = c("K04000001", "E92000001"),
  Name = c("ENGLAND AND WALES", "ENGLAND"),
  Geography = c("Country", "Country"),
  Mid_2024 = c(61806682, 58620101),
  Mid_2023 = c(61099801, 57932470),
  Mid_2022 = c(60278591, 57144395),
  Mid_2021 = c(59660524, 56554891),
  Mid_2020 = c(59430444, 56325961),
  Mid_2019 = c(59317788, 56230056),
  Mid_2018 = c(59008368, 55924528),
  Mid_2017 = c(58700914, 55619548),
  Mid_2016 = c(58366199, 55289034),
  Mid_2015 = c(57881415, 54808676),
  Mid_2014 = c(57444107, 54370319),
  Mid_2013 = c(56989744, 53918686),
  Mid_2012 = c(56577740, 53506812),
  Mid_2011 = c(56170927, 53107169)
) %>% pivot_longer(
  cols = starts_with("Mid_"),
  names_to = "Year",
  values_to = "Population"
) %>%
  mutate(
    Year = as.numeric(gsub("Mid_", "", Year))
  )


age_groups_2024 <- tribble(
  ~Age_Group,     ~England_and_Wales, ~England, ~Wales,
  "0 to 4",       3220651, 3072243, 148408,
  "5 to 9",       3574868, 3401724, 173144,
  "10 to 14",     3768955, 3581732, 187223,
  "15 to 19",     3696783, 3509155, 187628,
  "20 to 24",     3714108, 3526018, 188090,
  "25 to 29",     4078038, 3885571, 192467,
  "30 to 34",     4305830, 4101144, 204686,
  "35 to 39",     4279020, 4073458, 205562,
  "40 to 44",     4047573, 3855280, 192293,
  "45 to 49",     3653425, 3479767, 173658,
  "50 to 54",     3931133, 3728798, 202335,
  "55 to 59",     4083699, 3861340, 222359,
  "60 to 64",     3779003, 3562779, 216224,
  "65 to 69",     3137193, 2951642, 185551,
  "70 to 74",     2735296, 2568308, 166988,
  "75 to 79",     2588675, 2433995, 154680,
  "80 to 84",     1640827, 1543135,  97692,
  "85 to 89",     1007996,  951369,  56627,
  "90 and over",   563609,  532643,  30966
) %>% pivot_longer(
  cols = c("England_and_Wales","England","Wales"),
  names_to = "Year",
  values_to = "Population"
) %>%
  mutate(Year = 2024)


age_groups_ind_2024 <- data.frame(
  Code = c("K04000001", "E92000001"),
  Name = c("ENGLAND AND WALES", "ENGLAND"),
  Geography = c("Country", "Country"),
  All_ages = c("61,806,682", "58,620,101"),
  `0`  = c("601,329", "573,812"),
  `1`  = c("622,020", "593,575"),
  `2`  = c("660,624", "630,059"),
  `3`  = c("656,038", "625,948"),
  `4`  = c("680,640", "648,849"),
  `5`  = c("692,020", "659,421"),
  `6`  = c("701,206", "667,251"),
  `7`  = c("716,976", "682,421"),
  `8`  = c("735,470", "699,257"),
  `9`  = c("729,196", "693,374"),
  `10` = c("731,966", "695,901"),
  `11` = c("748,974", "712,018"),
  `12` = c("766,611", "728,659"),
  `13` = c("765,782", "727,289"),
  `14` = c("755,622", "717,865"),
  `15` = c("750,135", "712,549"),
  `16` = c("757,454", "719,178"),
  `17` = c("731,972", "695,590"),
  `18` = c("722,638", "686,352"),
  `19` = c("734,584", "695,486"),
  `20` = c("734,370", "695,274"),
  `21` = c("729,813", "691,406"),
  `22` = c("734,770", "697,351"),
  `23` = c("747,236", "710,646"),
  `24` = c("767,919", "731,341"),
  `25` = c("796,919", "759,095"),
  `26` = c("811,490", "773,516"),
  `27` = c("828,149", "788,460"),
  `28` = c("815,612", "777,372"),
  `29` = c("825,868", "787,128"),
  `30` = c("844,937", "805,239"),
  `31` = c("845,544", "805,672"),
  `32` = c("866,055", "824,590"),
  `33` = c("875,619", "833,482"),
  `34` = c("873,675", "832,161"),
  `35` = c("866,146", "824,692"),
  `36` = c("873,611", "831,419"),
  `37` = c("853,665", "812,545"),
  `38` = c("845,863", "805,362"),
  `39` = c("839,735", "799,440"),
  `40` = c("812,004", "773,610"),
  `41` = c("810,700", "772,141"),
  `42` = c("803,664", "765,546"),
  `43` = c("809,857", "771,457"),
  `44` = c("811,348", "772,526"),
  `45` = c("775,640", "738,963"),
  `46` = c("719,973", "686,219"),
  `47` = c("705,899", "672,429"),
  `48` = c("718,916", "684,749"),
  `49` = c("732,997", "697,407"),
  `50` = c("740,377", "703,813"),
  `51` = c("768,140", "729,388"),
  `52` = c("796,062", "754,938"),
  `53` = c("824,659", "780,892"),
  `54` = c("801,895", "759,767"),
  `55` = c("819,206", "775,106"),
  `56` = c("815,099", "771,539"),
  `57` = c("819,318", "774,808"),
  `58` = c("814,684", "770,180"),
  `59` = c("815,392", "769,707"),
  `60` = c("802,979", "757,491"),
  `61` = c("782,730", "738,322"),
  `62` = c("762,220", "718,569"),
  `63` = c("731,561", "689,549"),
  `64` = c("699,513", "658,848"),
  `65` = c("679,055", "639,143"),
  `66` = c("657,246", "618,514"),
  `67` = c("627,124", "589,882"),
  `68` = c("599,969", "564,430"),
  `69` = c("573,799", "539,673"),
  `70` = c("571,304", "536,645"),
  `71` = c("557,391", "523,049"),
  `72` = c("536,072", "503,524"),
  `73` = c("534,102", "501,510"),
  `74` = c("536,427", "503,580"),
  `75` = c("542,659", "509,713"),
  `76` = c("565,829", "531,492"),
  `77` = c("602,734", "567,237"),
  `78` = c("450,851", "424,408"),
  `79` = c("426,602", "401,145"),
  `80` = c("413,064", "388,753"),
  `81` = c("369,527", "347,609"),
  `82` = c("318,021", "298,656"),
  `83` = c("271,613", "255,001"),
  `84` = c("268,602", "253,116"),
  `85` = c("251,783", "237,616"),
  `86` = c("229,508", "216,590"),
  `87` = c("201,631", "190,245"),
  `88` = c("175,142", "165,268"),
  `89` = c("149,932", "141,650"),
  `90+`= c("563,609", "532,643"),
  check.names = FALSE,
  stringsAsFactors = FALSE
) %>%
  pivot_longer(
    cols = -c(Code, Name, Geography, All_ages),
    names_to = "Age",
    values_to = "Population"
  ) %>%
  mutate(
    Age = ifelse(Age == "90+", 90, as.numeric(Age)),
    Population = as.numeric(gsub(",", "", Population)),
    All_ages = as.numeric(gsub(",", "", All_ages))
  )

age_groups_ind_2023 <- read_excel("inputs/ons_age_sex_midyear.xlsx", 
                                  sheet = "MYE 2023") %>%
   mutate(temp = left(`LAD code`,1),
          country = ifelse(temp == "E","England","Wales"),
          `0` = `Aged under 1 year`,
          `90` = `Aged 90 years and over`) %>%
  select(-`LAD code`,-`LAD name`,-temp,-`Aged under 1 year`,-`Aged 90 years and over`,-sex,-`All ages`) %>%
  pivot_longer(
    cols = -country,              # keep country as id
    names_to = "Age",             # new column for age
    values_to = "Population"      # new column for population
  )







